CREATE DATABASE FINALASS_FPOLYSHOP_FA22_SOF205__SOF2041
USE FINALASS_FPOLYSHOP_FA22_SOF205__SOF2041
GO
-- ChucVu
CREATE TABLE ChucVu(
Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
Ma VARCHAR(20) UNIQUE,
Ten NVARCHAR(50) DEFAULT NULL
)
GO
-- CuaHang
CREATE TABLE CuaHang(
Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
Ma VARCHAR(20) UNIQUE,
Ten NVARCHAR(50) DEFAULT NULL,
DiaChi NVARCHAR(100) DEFAULT NULL,
ThanhPho NVARCHAR(50) DEFAULT NULL,
QuocGia NVARCHAR(50) DEFAULT NULL
)
GO
-- NhanVien
CREATE TABLE NhanVien(
Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
Ma VARCHAR(20) UNIQUE,
Ten NVARCHAR(30) DEFAULT NULL,
TenDem NVARCHAR(30) DEFAULT NULL,
Ho NVARCHAR(30) DEFAULT NULL,
GioiTinh NVARCHAR(10) DEFAULT NULL,
NgaySinh DATE DEFAULT NULL,
DiaChi NVARCHAR(100) DEFAULT NULL,
Sdt VARCHAR(30) DEFAULT NULL,
MatKhau VARCHAR(MAX) DEFAULT NULL,
IdCH UNIQUEIDENTIFIER,
IdCV UNIQUEIDENTIFIER,
IdGuiBC UNIQUEIDENTIFIER,
TrangThai INT DEFAULT 0
)
GO
-- KhachHang
CREATE TABLE KhachHang(
Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
Ma VARCHAR(20) UNIQUE,
Ten NVARCHAR(30),
TenDem NVARCHAR(30) DEFAULT NULL,
Ho NVARCHAR(30) DEFAULT NULL,
NgaySinh DATE DEFAULT NULL,
Sdt VARCHAR(30) DEFAULT NULL,
DiaChi NVARCHAR(100) DEFAULT NULL,
ThanhPho NVARCHAR(50) DEFAULT NULL,
QuocGia NVARCHAR(50) DEFAULT NULL,
MatKhau VARCHAR(MAX) DEFAULT NULL
)
GO
--HoaDon
CREATE TABLE HoaDon(
Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
IdKH UNIQUEIDENTIFIER,
IdNV UNIQUEIDENTIFIER,
Ma VARCHAR(20) UNIQUE,
NgayTao DATE DEFAULT NULL,
NgayThanhToan DATE DEFAULT NULL,
NgayShip DATE DEFAULT NULL,
NgayNhan DATE DEFAULT NULL,
TinhTrang INT DEFAULT 0,
TenNguoiNhan NVARCHAR(50) DEFAULT NULL,
DiaChi NVARCHAR(100) DEFAULT NULL,
Sdt VARCHAR(30) DEFAULT NULL,
)
GO
CREATE TABLE GioHang(
Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
IdKH UNIQUEIDENTIFIER,
IdNV UNIQUEIDENTIFIER,
Ma VARCHAR(20) UNIQUE,
NgayTao DATE DEFAULT NULL,
NgayThanhToan DATE DEFAULT NULL,
TenNguoiNhan NVARCHAR(50) DEFAULT NULL,
DiaChi NVARCHAR(100) DEFAULT NULL,
Sdt VARCHAR(30) DEFAULT NULL,
TinhTrang INT DEFAULT 0
)
GO
-- SanPham
CREATE TABLE SanPham(
Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
Ma VARCHAR(20) UNIQUE,
Ten NVARCHAR(30)
)
GO
-- NSX
CREATE TABLE NSX(
Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
Ma VARCHAR(20) UNIQUE,
Ten NVARCHAR(30)
)
GO
-- MauSac
CREATE TABLE MauSac(
Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
Ma VARCHAR(20) UNIQUE,
Ten NVARCHAR(30)
)
GO
-- DongSP
CREATE TABLE DongSP(
Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
Ma VARCHAR(20) UNIQUE,
Ten NVARCHAR(30)
)
GO
-- ChiTietSP
CREATE TABLE ChiTietSP(
Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
IdSP UNIQUEIDENTIFIER,
IdNsx UNIQUEIDENTIFIER,
IdMauSac UNIQUEIDENTIFIER,
IdDongSP UNIQUEIDENTIFIER,
NamBH INT DEFAULT NULL,
MoTa NVARCHAR(50) DEFAULT NULL,
SoLuongTon INT,
GiaNhap DECIMAL(20,0) DEFAULT 0,
GiaBan DECIMAL(20,0) DEFAULT 0,
)

GO
-- HoaDonChiTiet
CREATE TABLE HoaDonChiTiet(
IdHoaDon UNIQUEIDENTIFIER,
IdChiTietSP UNIQUEIDENTIFIER,
SoLuong INT,
DonGia DECIMAL(20,0) DEFAULT 0,
CONSTRAINT PK_HoaDonCT PRIMARY KEY (IdHoaDon,IdChiTietSP),
CONSTRAINT FK1 FOREIGN KEY(IdHoaDon) REFERENCES HoaDon(Id),
CONSTRAINT FK2 FOREIGN KEY(IdChiTietSP) REFERENCES ChiTietSP(Id),
)
GO
CREATE TABLE GioHangChiTiet(
IdGioHang UNIQUEIDENTIFIER,
IdChiTietSP UNIQUEIDENTIFIER,
SoLuong INT,
DonGia DECIMAL(20,0) DEFAULT 0,
DonGiaKhiGiam DECIMAL(20,0) DEFAULT 0,
CONSTRAINT PK_GioHangCT PRIMARY KEY (IdGioHang,IdChiTietSP),
CONSTRAINT FK1_IdGioHang FOREIGN KEY(IdGioHang) REFERENCES GioHang(Id),
CONSTRAINT FK2_IdChiTietSP FOREIGN KEY(IdChiTietSP) REFERENCES ChiTietSP(Id),
)
GO
--TẠO QUAN HỆ GIỮA CÁC BẢNG
--NhanVien - CuaHang
ALTER TABLE NhanVien ADD FOREIGN KEY (IdCH) REFERENCES CuaHang(Id)
--NhanVien - ChucVu
ALTER TABLE NhanVien ADD FOREIGN KEY (IdCV) REFERENCES ChucVu(Id)
--NhanVien - GuiBaoCao
ALTER TABLE NhanVien ADD FOREIGN KEY (IdGuiBC) REFERENCES NhanVien(Id)
-- HoaDon - KhachHang
ALTER TABLE HoaDon ADD FOREIGN KEY (IdKH) REFERENCES KhachHang(Id)
-- GioHang - KhachHang
ALTER TABLE GioHang ADD FOREIGN KEY (IdKH) REFERENCES KhachHang(Id)
-- HoaDon - NhanVien
ALTER TABLE HoaDon ADD FOREIGN KEY (IdNV) REFERENCES NhanVien(Id)
-- ChiTietSP - SanPham
ALTER TABLE ChiTietSP ADD FOREIGN KEY(IdSP) REFERENCES SanPham(Id)
-- ChiTietSP - NSX
ALTER TABLE ChiTietSP ADD FOREIGN KEY(IdNsx) REFERENCES Nsx(Id)
-- ChiTietSP - MauSac
ALTER TABLE ChiTietSP ADD FOREIGN KEY(IdMauSac) REFERENCES MauSac(Id)
-- ChiTietSP - DongSP
ALTER TABLE ChiTietSP ADD FOREIGN KEY(IdDongSP) REFERENCES DongSP(Id)

--ChucVu
Select * from ChucVu 
INSERT INTO ChucVu VALUES (NEWID(),'CV01',N'Quản lý')
INSERT INTO ChucVu VALUES (NEWID(),'CV02',N'Nhân viên')
INSERT INTO ChucVu VALUES (NEWID(),'CV03',N'Trưởng phòng')
-- CuaHang
Select * from ChucVu 
Select * from CuaHang
INSERT INTO CuaHang VALUES(NEWID(),'CH01',N'Laptop AZ',N'20 Hồ Tùng Mậu',N'Hà Nội',N'Việt Nam')
INSERT INTO CuaHang VALUES(NEWID(),'CH02',N'Laptop LAZ',N'91 Kiều Mai',N'Hà Nội',N'Việt Nam')
INSERT INTO CuaHang VALUES(NEWID(),'CH03',N'Laptop HQ',N'135 Cổ Nhuế',N'Hà Nội',N'Việt Nam')
INSERT INTO CuaHang VALUES(NEWID(),'CH04',N'Laptop FPT',N'137 Mai Dịch',N'Hà Nội',N'Việt Nam')
INSERT INTO CuaHang VALUES(NEWID(),'CH05',N'Laptop HaoNgo',N'44 Khúc Thừa Dụ',N'Hà Nội',N'Việt Nam')
--NhanVien
Select * from ChucVu 
Select * from CuaHang
Select * from NhanVien
INSERT INTO NhanVien VALUES(NEWID(),'NV05',N'Kiên',N'Chí',N'Phùng',N'Nam','2-2-2003',N'66 Hồ Tùng Mậu','0989546734','nv',null,null,null,0)
INSERT INTO NhanVien VALUES(NEWID(),'NV04',N'Kiên',N'Đình',N'Nguyễn',N'Nam','4-2-2003',N'132 Cầu Giấy','0989034443','nv',null,null,null,0)
INSERT INTO NhanVien VALUES(NEWID(),'NV03',N'Nhân',N'Hữu',N'Phạm',N'Nam','9-9-2003',N'17 Phú Diễn','0980932103','nv',null,null,null,0)
INSERT INTO NhanVien VALUES(NEWID(),'NV02',N'Kiên',N'Đình',N'Nguyễn',N'Nam','9-2-2003',N'20 Mĩ Đình','0989032103','nv',null,null,null,0)
INSERT INTO NhanVien VALUES(NEWID(),'NV01',N'Hào',N'Vũ Ngọc',N'Ngô',N'Nam','11-11-2003',N'18 ngõ 17 Kiều Mai','0989031433','nv','B319D987-A8E8-4F2E-AA07-04971B80A17B','7B207626-43F2-4960-B3B5-811DA525734B',null,0)
--KhachHang
Select * from KhachHang
INSERT INTO KhachHang VALUES(NEWID(),'KH01',N'Đạo',N'Thành',N'Phạm','2-2-2003','0989546734',N'66 Hồ Tùng Mậu',N'Hà Nội',N'Việt Nam','kh')
INSERT INTO KhachHang VALUES(NEWID(),'KH02',N'Hùng',N'Văn',N'Phạm','2-6-2003','0989509734',N'91 Kiều Mai',N'Hà Nội',N'Việt Nam','kh')
INSERT INTO KhachHang VALUES(NEWID(),'KH03',N'Hùng',N'Văn',N'Nguyễn','8-6-2003','0989546701',N'135 Cổ Nhuế',N'Hà Nội',N'Việt Nam','kh')
INSERT INTO KhachHang VALUES(NEWID(),'KH04',N'Dung',N'Phương',N'Nguyễn','5-9-2003','0989546702',N'137 Mai Dịch',N'Hà Nội',N'Việt Nam','kh')
INSERT INTO KhachHang VALUES(NEWID(),'KH05',N'Phương',N'Mai',N'Phạm','7-7-2003','0989546706',N'44 Khúc Thừa Dụ',N'Hà Nội',N'Việt Nam','kh')
--HoaDon
Select * from HoaDon
Select * from NhanVien
Select * from KhachHang
INSERT INTO HoaDon VALUES(NEWID(),'66B2EC80-335E-432A-A58B-081DC131D5F2','C18FF9DB-6A64-468D-BA58-BFE3DD11DB67','HD01','10-5-2022','10-5-2022','10-6-2022','10-7-2022',0,N'Phương',N'44 Khúc Thừa Dụ, Hà Nội','0989546706')
INSERT INTO HoaDon VALUES(NEWID(),'2076C411-D552-4E0E-82EA-65D57058000B',null,'HD02','10-6-2022','10-6-2022','10-7-2022','10-8-2022',0,N'Hùng',N'91 Kiều Mai, Hà Nội','0989509734')
INSERT INTO HoaDon VALUES(NEWID(),'F8C95201-E3DA-4D0B-BF9E-84924F668FEF','0119DF34-FB74-46AB-B4E1-CB74BD57C58C','HD03','10-6-2022','10-6-2022','10-7-2022','10-8-2022',0,N'Hùng',N'91 Kiều Mai, Hà Nội','0989509734')

--GioHang
Select * from GioHang
Select * from HoaDon

INSERT INTO GioHang VALUES(NEWID(),'66B2EC80-335E-432A-A58B-081DC131D5F2','C18FF9DB-6A64-468D-BA58-BFE3DD11DB67','GH01','10-5-2022','10-5-2022',N'Phương',N'44 Khúc Thừa Dụ, Hà Nội','0989546706',0)
INSERT INTO GioHang VALUES(NEWID(),'F8C95201-E3DA-4D0B-BF9E-84924F668FEF','0119DF34-FB74-46AB-B4E1-CB74BD57C58C','GH02','10-6-2022','10-6-2022',N'Hùng',N'91 Kiều Mai, Hà Nội','0989509734',0)
INSERT INTO GioHang VALUES(NEWID(),'A7C699E6-CFB9-4E44-B393-FCB049288608',null,'GH03','10-6-2022',null,N'Hùng',N'135 Cổ Nhuế, Hà Nội','0989546701',1)
INSERT INTO GioHang VALUES(NEWID(),'ADC73522-65DA-4AC1-A70E-90AC36386EA1',null,'GH04','10-7-2022',null,N'Đạo',N'66 Hồ Tùng Mậu, Hà Nội','0989546734',1)
INSERT INTO GioHang VALUES(NEWID(),'F8C95201-E3DA-4D0B-BF9E-84924F668FEF',null,'GH05','10-8-2022',null,N'Dung',N'91 Kiều Mai, Hà Nội','0989546702',1)


--SanPham
Select * from SanPham
INSERT INTO SanPham VALUES (NEWID(),'SP01',N'Laptop IT')
INSERT INTO SanPham VALUES (NEWID(),'SP02',N'Laptop Gaming')
INSERT INTO SanPham VALUES (NEWID(),'SP03',N'Laptop Gaming X')
INSERT INTO SanPham VALUES (NEWID(),'SP04',N'Laptop Adobe')
INSERT INTO SanPham VALUES (NEWID(),'SP05',N'Laptop Suzuki')
INSERT INTO SanPham VALUES (NEWID(),'SP06',N'Laptop China')
--nsx
Select * from NSX
INSERT INTO NSX VALUES (NEWID(),'NSX01',N'11-14-2012')
INSERT INTO NSX VALUES (NEWID(),'NSX02',N'10-12-2011')
INSERT INTO NSX VALUES (NEWID(),'NSX03',N'03-11-2009')
INSERT INTO NSX VALUES (NEWID(),'NSX04',N'06-21-2020')
INSERT INTO NSX VALUES (NEWID(),'NSX05',N'09-09-2019')
INSERT INTO NSX VALUES (NEWID(),'NSX06',N'07-08-2018')

--mausac
Select * from MauSac
INSERT INTO MauSac VALUES (NEWID(),'MS01',N'Đen')
INSERT INTO MauSac VALUES (NEWID(),'MS02',N'Trắng')
INSERT INTO MauSac VALUES (NEWID(),'MS03',N'Bạc')
INSERT INTO MauSac VALUES (NEWID(),'MS04',N'Đen trắng')
INSERT INTO MauSac VALUES (NEWID(),'MS05',N'Xanh')

--dongSP
Select * from DongSP
INSERT INTO DongSP VALUES (NEWID(),'DSP01',N'Dell')
INSERT INTO DongSP VALUES (NEWID(),'DSP02',N'Asus')
INSERT INTO DongSP VALUES (NEWID(),'DSP03',N'Acer')
INSERT INTO DongSP VALUES (NEWID(),'DSP04',N'ThinhPad')
INSERT INTO DongSP VALUES (NEWID(),'DSP05',N'Mac')
--ctsp
Select * from ChiTietSP
Select * from SanPham
Select * from NSX
Select * from MauSac
Select * from DongSP
Insert into ChiTietSP values(NEWID(),'DCEDBA3B-73C2-48E9-BFC3-F7988FE38596','95BC448B-A1F0-443E-9A06-8FC7EDF20F23','95EA42B1-E69A-4127-BB26-BA7E9F47A9E1','6F149943-03DB-4EC2-BCB5-E8BA32C6C66D',2023,N'Tốc độ xử lí nhanh',120,25000000,30000000)
Insert into ChiTietSP values(NEWID(),'FD30455F-C73F-4BE3-81D1-E5BDF7688AC6','83F7C2FB-76EA-4579-B5EC-34532EA6926F','581382CF-BC7D-4B52-B27C-C1891F7BF1BE','E828B1F5-75B5-4BF2-BC55-89F7C547C992',2022,N'Nhỏ gọn',340,35000000,40000000)
Insert into ChiTietSP values(NEWID(),'D15BAD41-4758-4F59-933E-E8CB0ED3AA2E','9804042C-7B5A-401B-9EDC-BD25C5C1F5DA','F7FE99C6-67EF-433F-9E32-4BF95C6CA3A8','C8CC5771-14A0-427E-8FE3-F287E1060173',2024,N'Tốc độ xử lí nhanh',220,45000000,50000000)
Insert into ChiTietSP values(NEWID(),'02BEF451-FD2E-482A-BDA2-83293A72BBB8','5E2F476D-CD87-4743-A2A5-65C87F023E57',null,null,2023,N'Đồ họa tốt',120,36000000,38000000)
Insert into ChiTietSP values(NEWID(),null,null,null,null,2023,N'Đồ họa tốt',120,36000000,38000000)

--hdct
Select * from HoaDonChiTiet
Select * from HoaDon
Select * from ChiTietSP
insert into HoaDonChiTiet values('AE7D1AD4-A6CE-4A1B-8588-B423DE8BEED5','1F7B4F0D-A32F-44FD-8422-17DE397CD252',2,100000000)
insert into HoaDonChiTiet values('0BAD5299-3106-49C5-B7E3-2A5549D560C9','758BBBE2-35A4-448A-872D-38FEAF9FF0AD',1,38000000)

--ghct
Select * from GioHangChiTiet
Select * from GioHang
Select * from HoaDonChiTiet
insert into GioHangChiTiet values('97D9A86C-2DA3-4F4F-A240-992D7939FC21','1F7B4F0D-A32F-44FD-8422-17DE397CD252',2,100000000,95000000)
insert into GioHangChiTiet values('FAC035F0-69AF-47B0-8B60-A68882A16007','758BBBE2-35A4-448A-872D-38FEAF9FF0AD',1,38000000,37500000)
--CTSP
Select ctsp.Id, sp.Ten,n.Ten, m.Ten, d.ten,NamBH, MoTa, SoLuongTon, GiaNhap, GiaBan from ChiTietSP ctsp
inner join SanPham sp on sp.Id=ctsp.IdSP
inner join NSX n on n.Id=ctsp.IdNsx
inner join MauSac m on m.Id=ctsp.IdMauSac
inner join DongSP d on d.Id=ctsp.IdDongSP
order by SoLuongTon desc
--HDCT
	Select sp.Ten, NgayThanhToan, TenNguoiNhan, SoLuong, DonGia, TinhTrang FROM HoaDonChiTiet hdct
                INNER JOIN HoaDon hd on hdct.IdHoaDon=hd.Id
                INNER JOIN ChiTietSP ctsp on ctsp.Id = hdct.IdChiTietSP
				INNER JOIN SanPham sp on ctsp.IdSP = sp.Id
Delete from ChiTietSP where id like '7B8B5071-A093-49EA-8002-EF81D6DB7EAC'